<script>
  // حوّل الأرقام العربية إلى إنجليزية
  const toAsciiDigits = s => s.replace(/[٠-٩]/g, d => '٠١٢٣٤٥٦٧٨٩'.indexOf(d));

  // تنظيف عام
  const onlyDigits = s => toAsciiDigits(s).replace(/\D/g, '');

  function buildWaNumber(countryCodeRaw, numberRaw){
    let cc = onlyDigits(countryCodeRaw);   // رمز الدولة بدون +
    let n  = onlyDigits(numberRaw);        // الرقم

    // عالج 00 و 0 في بداية الرقم
    if (n.startsWith('00')) n = n.slice(2);
    while (n.startsWith('0')) n = n.slice(1);

    // لو المستخدم لصق الرقم الدولي كامل (يبدأ برمز الدولة)، لا تكرر الرمز
    if (cc && n.startsWith(cc)) {
      n = n.slice(cc.length);
      while (n.startsWith('0')) n = n.slice(1); // تأكيد إزالة أي صفر بعد القص
    }

    // تحقق الطول
    const full = cc + n;
    if (!cc || !/^\d{1,4}$/.test(cc)) throw new Error('رمز الدولة غير صحيح');
    if (!/^\d{6,15}$/.test(n)) throw new Error('رقم الجوال غير صحيح');

    return full; // مثال: 966512345678
  }

  // مثال استخدام داخل زر الفتح:
  // const full = buildWaNumber(countryInput.value, phoneInput.value);
  // const url = text ? `https://wa.me/${full}?text=${encodeURIComponent(text)}` : `https://wa.me/${full}`;
</script>
